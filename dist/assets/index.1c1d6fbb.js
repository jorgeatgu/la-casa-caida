import{S as t,a as e,s as a,b as n,m as s,c as o,d as c,e as i,f as r,g as l,h as p,i as d,t as u,l as m,o as y,j as g,k as f,n as x,p as h,q as v,r as $,u as b,v as k,w as L,x as w,y as z,z as S,A as P,B as A}from"./vendor.5ea79887.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(a){const n=new URL(t,location),s=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((a,o)=>{const c=new URL(t,n);if(self[e].moduleMap[c])return a(self[e].moduleMap[c]);const i=new Blob([`import * as m from '${c}';`,`${e}.moduleMap['${c}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){o(new Error(`Failed to import: ${t}`)),s(r)},onload(){a(self[e].moduleMap[c]),s(r)}});document.head.appendChild(r)})),self[e].moduleMap={}}}("/assets/");new t({select:"#select-lb-huesca",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-lb-zaragoza",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-lb-teruel",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-city-teruel",searchPlaceholder:"Busca tu municipio"}),new t({select:"#filter-city-teruel",searchPlaceholder:"Filtra por municipio"}),new t({select:"#percentage-over-city-teruel",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#percentage-under-city-teruel",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#select-city-huesca",searchPlaceholder:"Busca tu municipio"}),new t({select:"#filter-city-huesca",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#percentage-over-city-huesca",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#percentage-under-city-huesca",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#select-city-zaragoza",searchPlaceholder:"Busca tu municipio"}),new t({select:"#filter-city-zaragoza",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#percentage-over-city-zaragoza",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#percentage-under-city-zaragoza",searchPlaceholder:"Filtra tu municipio"}),new t({select:"#select-first-year-zaragoza",searchPlaceholder:"Selecciona el primer año"}),new t({select:"#select-second-year-zaragoza",searchPlaceholder:"Selecciona el segundo año"}),new t({select:"#select-first-year-teruel",searchPlaceholder:"Selecciona el primer año"}),new t({select:"#select-second-year-teruel",searchPlaceholder:"Selecciona el segundo año"}),new t({select:"#select-first-year-huesca",searchPlaceholder:"Selecciona el primer año"}),new t({select:"#select-second-year-huesca",searchPlaceholder:"Selecciona el segundo año"}),new t({select:"#select-municipalities-stack-huesca",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-municipalities-stack-zaragoza",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-municipalities-stack-teruel",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-densidad-huesca",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-densidad-zaragoza",searchPlaceholder:"Busca tu municipio"}),new t({select:"#select-densidad-teruel",searchPlaceholder:"Busca tu municipio"});const B=window.innerWidth>0?window.innerWidth:screen.width;const C={select:a,selectAll:n,min:s,max:o,bisector:c,extent:i,curveCardinal:r,area:l,stack:p,stackOrderInsideOut:d,scaleTime:u,scaleLinear:m,scaleOrdinal:y,axisBottom:g,axisLeft:f,csv:x,format:h};const F={select:a,selectAll:n,min:s,max:o,extent:i,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,easeQuad:v};function V(t,e){let a,n=0,s=0,o=0,c=0;const i={top:0,right:8,bottom:64,left:40},r=F.select(`.scatter-${e}`),l=r.select("svg"),p={},d=r.append("div").attr("class","tooltip tooltip-under-over").attr("id","tooltip-scatter").style("opacity",0);function u(t){o=r.node().offsetWidth,c=600;const{left:a,right:u,top:m,bottom:y}=i;n=o-a-u,s=c-m-y,l.attr("width",o).attr("height",c);const g=`translate(${a},${m})`,f=l.select(`.scatter-${e}-container`);f.attr("transform",g),function(t,e){const{count:{x:a,y:n}}=p;a.range([0,t]),n.range([e,20])}(n,s);const x=r.select(`.scatter-${e}-container-bis`).selectAll(".scatter-circles").data(t),h=x.enter().append("circle").attr("class",`scatter-${e}-circles scatter-circles`);x.merge(h).on("mouseover",(function(t,e){d.transition(),d.style("opacity",1).html(`<p class="tooltip-citi">${e.city}<p/>\n            <p class="tooltip-population-text">Habitantes: <span class="tooltip-number">${e.population}</span><p/>\n            <p class="tooltip-over">Mayores de 65: <span class="tooltip-number">${e.mayor}%</span><p/>\n            <p class="tooltip-under">Menores de 18: <span class="tooltip-number">${e.menor}%</span><p/>\n            `).style("left",o/2-150+"px").style("top","100px")})).on("mouseout",(function(t){d.transition().duration(200).style("opacity",0)})).attr("cx",(t=>p.count.x(t.mayor))).attr("cy",(t=>p.count.y(t.menor))).attr("r",0).transition().duration(600).ease(F.easeQuad).attr("cx",(t=>p.count.x(t.mayor))).attr("cy",(t=>p.count.y(t.menor))).attr("r",6),function(t){const e=F.axisBottom(p.count.x).tickFormat((t=>t+"%")).tickPadding(11).ticks(10);t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=F.axisLeft(p.count.y).tickFormat((t=>t+"%")).tickSize(-n).ticks(5);t.select(".axis-y").call(a)}(f)}function m(){F.csv(t).then((n=>{const s=n.map((({name:t})=>t)),o=F.select(`#filter-city-${e}`);o.selectAll("option").data(s).enter().append("option").attr("value",(t=>t)).text((t=>t)),o.on("change",(function(){F.select(`#percentage-over-city-${e} option`).property("selected","0"),F.select(`#percentage-under-city-${e} option`).property("selected","0"),F.selectAll(".tooltip-percentage").remove().exit(),F.csv(t).then((t=>{const n=F.select(`#filter-city-${e}`).property("value");F.selectAll(`.scatter-${e}-circles`).transition().duration(400).attr("r",0),a=t.filter((({name:t})=>t===n)),a.forEach((t=>{t.mayor=+t.mayor,t.menor=+t.menor,t.city=t.name})),u(a)}))}))}))}F.select(`#clear-filter-${e}`).on("click",(function(){F.select(`#percentage-over-city-${e} option`).property("selected","0"),F.select(`#percentage-under-city-${e} option`).property("selected","0"),F.selectAll(".tooltip-percentage").remove().exit(),F.csv(t).then((t=>{a=t,a.forEach((t=>{t.mayor=+t.mayor,t.menor=+t.menor,t.city=t.name})),u(a)}))})),window.addEventListener("resize",(function(){u(a)})),F.csv(t).then((n=>{a=n.map((t=>({mayor:+t.mayor,menor:+t.menor,population:+t.population,city:t.name,over:t.percentagemayor,under:t.percentagemenor}))),function(){const t=l.select(`.scatter-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`scatter-${e}-container-bis`),t.append("text").attr("class","legend").attr("y","97%").attr("x","35%").style("text-anchor","start").text("Mayores de 65 años"),t.append("text").attr("class","legend").attr("x","-350").attr("y","-30").attr("transform","rotate(-90)").style("text-anchor","start").text("Menores de 18 años")}(),function(){const t=F.scaleLinear().domain([0,75]),e=F.scaleLinear().domain([0,F.max(a,(t=>1.75*t.menor))]);p.count={x:t,y:e}}(),u(a),m(),F.select(`#percentage-over-city-${e}`).on("change",(function(){F.select(`#percentage-under-city-${e} option`).property("selected","0");const n=F.select(this).property("value");F.csv(t).then((t=>{F.selectAll(`.scatter-${e}-circles`).transition().duration(400).attr("r",0),a=t.filter((({mayor:t})=>t>n)),console.log("data",t),console.log("dataScatterPeople",a.length),r.select(`.scatter-${e}-container-bis`),F.selectAll(".tooltip-percentage").remove().exit(),r.append("div").attr("class","tooltip tooltip-percentage").html(`\n            <p class="tooltip-population"><span class="tooltip-number">En ${a.length}</span> municipios el % de habitantes mayores de 65 años es superior al <span class="tooltip-number">${n}%</span>. <p/>\n            `).style("right",i.right+"px").style("top","50px"),a.forEach((t=>{t.city=t.name})),u(a)}))})),F.select(`#percentage-under-city-${e}`).on("change",(function(){F.select(`#percentage-over-city-${e} option`).property("selected","0");const n=F.select(this).property("value");console.log("percentageCity",n),F.csv(t).then((t=>{a=t,F.selectAll(`.scatter-${e}-circles`).transition().duration(400).attr("r",0),a=a.filter((({menor:t})=>t>n)),r.select(`.scatter-${e}-container-bis`),F.selectAll(".tooltip-percentage").remove().exit(),r.append("div").attr("class","tooltip tooltip-percentage").html(`\n            <p class="tooltip-population"><span class="tooltip-number">En ${a.length}</span> municipios el % de habitantes menores de 18 años es superior al <span class="tooltip-number">${n}%</span>. <p/>\n            `).style("right",i.right+"px").style("top","50px"),a.forEach((t=>{t.city=t.name})),u(a)}))}))}))}const E={select:a,selectAll:n,nest:$,min:s,max:o,scaleLinear:m,scaleBand:b,axisBottom:g,axisLeft:f,csv:x,format:h};function T(t,e){const a={top:24,right:8,bottom:24,left:40};let n=0,s=0,o=0,c=0;const i=E.select(`.bar-negative-${e}`),r=i.select("svg"),l={};let p;const d=i.append("div").attr("class","tooltip tooltip-negative").style("opacity",0);function u(t){o=i.node().offsetWidth,c=600;const{left:p,right:u,top:m,bottom:y}=a;n=o-p-u,s=c-m-y,r.attr("width",o).attr("height",c);const g=`translate(${p},${m})`,f=r.select(`.bar-negative-${e}-container`);f.attr("transform",g),function(t,e){const{count:{x:a,y:n}}=l;a.rangeRound([0,t]).paddingInner(.2),n.range([e,0])}(n,s);const x=i.select(`.bar-negative-${e}-container-bis`).selectAll(".bar-vertical").data(t),h=x.enter().append("rect").attr("class",(t=>t.saldo<0?"negative":"positive"));x.merge(h).on("mouseover",(function(t,e){d.transition(),d.style("opacity",1).html(`\n            <p class="tooltip-year"><span class="tooltip-number">${e.year}</span><p/>\n            <p class="tooltip-born">Nacidos: <span class="tooltip-number">${e.nacidos}</span><p/>\n            <p class="tooltip-deceased">Fallecidos: <span class="tooltip-number">${e.fallecidos}</span><p/>\n            <p class="tooltip-deceased">Saldo: <span class="tooltip-number">${e.saldo}</span><p/>\n            `).style("left",o/2-100+"px").style("top","50px")})).on("mouseout",(function(t){d.transition().duration(200).style("opacity",0)})).attr("width",l.count.x.bandwidth()).attr("x",(t=>l.count.x(t.year))).attr("y",(t=>t.saldo>0?l.count.y(t.saldo):l.count.y(0))).attr("height",(t=>Math.abs(l.count.y(t.saldo)-l.count.y(0)))),function(t){const e=E.axisBottom(l.count.x).tickValues(l.count.x.domain().filter(((t,e)=>!(e%6))));t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=E.axisLeft(l.count.y).tickFormat(E.format("d")).ticks(5).tickSize(-n).tickPadding(8);t.select(".axis-y").call(a)}(f)}window.addEventListener("resize",(function(){u(p)})),E.csv(t).then((t=>{p=t,function(){const t=r.select(`.bar-negative-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`bar-negative-${e}-container-bis`)}(),function(){E.min(p,(t=>t.saldo));const t=E.max(p,(t=>t.saldo)),e=E.scaleBand().domain(p.map((t=>t.year))),a=E.scaleLinear().domain([E.min(p,(t=>2*t.saldo)),E.max(p,(e=>t<300?E.max(p,(t=>6*t.saldo)):E.max(p,(t=>2.5*t.saldo))))]);l.count={x:e,y:a}}(),u(p)}))}const M={select:a,selectAll:n,min:s,max:o,line:k,scaleTime:u,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,format:h,formatDefaultLocale:L};function W(t,e){const a={top:8,right:8,bottom:24,left:8};let n=0,s=0;const o=M.select(`.line-${e}`),c=o.select("svg"),i={};let r;const l=M.select(`.line-province-${e}`).append("div").attr("class","tooltip tooltip-population").style("opacity",0),p=M.formatDefaultLocale({decimal:",",thousands:".",grouping:[3]});function d(t){const r=o.node().offsetWidth,{left:d,right:u,top:m,bottom:y}=a;n=r-d-u,s=550-m-y,c.attr("width",r).attr("height",550);const g=`translate(${d},${m})`,f=c.select(`.line-${e}-container`);f.attr("transform",g);const x=M.line().x((t=>i.count.x(t.year))).y((t=>i.count.y(t.total)));!function(t,e){const{count:{x:a,y:n}}=i;a.range([90,t]),n.range([e,0])}(n,s);const h=o.select(`.line-${e}-container-bis`),v=h.selectAll(".line").data([t]),$=v.enter().append("path").attr("class","line").attr("stroke-width","1.5"),b=h.selectAll(".circles").data(t),k=b.enter().append("circle").attr("class","circles").attr("fill","#531f4e");v.merge($).attr("d",x),b.merge(k).on("mouseover",((t,e)=>{const{pageX:a,pageY:n}=t,s=i.count.x(e.year)+270,o=`${a}px`,c=a-210+"px";l.transition(),l.style("opacity",1).html(`<p class="tooltip-deceased">La población en <span class="tooltip-number">${e.year}</span> era de <span class="tooltip-number">${e.total}</span> habitantes<p/>`).style("left",s>r?c:o).style("top",n-48+"px")})).on("mouseout",(()=>{l.transition().duration(200).style("opacity",0)})).attr("cx",(t=>i.count.x(t.year))).attr("cy",(t=>i.count.y(t.total))).attr("r",4),function(t){const e=M.axisBottom(i.count.x).tickFormat(M.format("d")).ticks(9);t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=p.format(",.0f"),o=M.axisLeft(i.count.y).tickFormat((t=>`${a(t)} hab`)).ticks(6).tickSizeInner(-n);t.select(".axis-y").call(o),t.selectAll(".axis-y .tick text").attr("x",80).attr("dy",-5)}(f)}window.addEventListener("resize",(function(){d(r)})),M.csv(t).then((t=>{r=t,function(){const t=c.select(`.line-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-${e}-container-bis`)}(),function(){const t=M.scaleTime().domain([M.min(r,(t=>t.year)),M.max(r,(t=>t.year))]),e=M.scaleLinear().domain([M.min(r,(t=>t.total/1.25)),M.max(r,(t=>1.25*t.total))]);i.count={x:t,y:e}}(),d(r)}))}const O={select:a,selectAll:n,min:s,max:o,line:k,scaleTime:u,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,easeLinear:w,format:h,interpolatePath:z};function Y(t,e){const a={top:16,right:8,bottom:24,left:62};a.left=B>544?62:32;let n=0,s=0;const o=O.select(`.line-population-${e}`),c=o.select("svg");let i,r={};const l=O.select(`.${e}-line`),p=o.append("div").attr("class","tooltip tooltip-over"),d=l.append("div").attr("class","tooltip tooltip-population").style("opacity",0);function u(){const t=O.scaleTime().domain([O.min(i,(t=>t.year)),O.max(i,(t=>t.year))]),e=O.scaleLinear().domain([0,1.25*O.max(i,(t=>t.population))]);r.count={x:t,y:e}}function m(t){const l=o.node().offsetWidth,{left:p,right:u,top:m,bottom:y}=a;n=l-p-u,s=500-m-y,c.attr("width",l).attr("height",500);const g=`translate(${p},${m})`,f=c.select(`.line-population-${e}-container`);f.attr("transform",g);const x=O.line().x((t=>r.count.x(t.year))).y((t=>r.count.y(t.population)));!function(t,e){const{count:{x:n,y:s}}=r;n.range([0,t-a.right]),s.range([e,0])}(n,s);const h=o.select(`.line-population-${e}-container-bis`),v=h.selectAll(".lines").data([i]),$=h.selectAll(".circles-population").remove().exit().data(i),b=v.enter().append("path").attr("class","lines");v.merge(b).transition().duration(400).ease(O.easeLinear).attrTween("d",(function(t){const e=O.select(this).attr("d"),a=x(t);return O.interpolatePath(e,a)}));const k=$.enter().append("circle").attr("class","circles-population").attr("fill","#531f4e");$.merge(k).on("mouseover",((t,e)=>{const{year:a,population:n}=e,{pageX:s,pageY:o}=t,c=r.count.x(a)+270,i=`${s}px`,p=s-210+"px";d.transition(),d.style("opacity",1).html(`<p class="tooltip-deceased">La población en <span class="tooltip-number">${a}</span> era de <span class="tooltip-number">${n}</span> habitantes<p/>`).style("left",c>l?p:i).style("top",o-48+"px")})).on("mouseout",(()=>{d.transition().duration(200).style("opacity",0)})).attr("cx",(t=>r.count.x(t.year))).attr("cy",(t=>r.count.y(t.population))).attr("r",0).transition().duration(400).ease(O.easeLinear).attr("cx",(t=>r.count.x(t.year))).attr("cy",(t=>r.count.y(t.population))).attr("r",4),function(t){const e=O.axisBottom(r.count.x).tickPadding(4).tickFormat(O.format("d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=O.axisLeft(r.count.y).tickPadding(5).tickFormat(O.format("d")).tickSize(-n).ticks(6);t.select(".axis-y").transition().duration(450).ease(O.easeLinear).call(a)}(f)}function y(){O.csv(t).then((t=>{const a=O.select(`#select-city-${e}`).property("value");i=t.filter((({name:t})=>t===a)),i.forEach((t=>{t.population=+t.population,t.year=+t.year})),u(),m(),function(t){const e=t[0].population,a=t.slice(-1)[0].population;o.node().offsetWidth;const n=a-e;let s=(100*(e-a)/e).toFixed(2),c=(100*n/e).toFixed(2);const r=e>a?`<p class="tooltip-deceased">Desde 1900 su población ha disminuido en un <span class="tooltip-number">${s}%</span><p/>`:`<p class="tooltip-deceased">Desde 1900 su población ha aumentado en un <span class="tooltip-number">${c}%</span><p/>`,l=e>a?"20px":"73%";p.data(i).html((t=>`\n        ${r}\n        <p class="tooltip-deceased">Mayores de 65 años en 2020: <span class="tooltip-number">${t.mayor}%</span><p/>\n        <p class="tooltip-deceased">Menores de 18 años en 2020: <span class="tooltip-number">${t.menor}%</span><p/>\n        `)).transition().duration(300).style("top",`${l}`)}(i)}))}window.addEventListener("resize",(function(){m()})),O.csv(t).then((t=>{i=t.map((t=>({year:+t.year,population:+t.population}))),function(){const t=c.select(`.line-population-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-population-${e}-container-bis`)}(),u(),m(),y()})),O.csv(t).then((t=>{const a=[...new Set(t.map((({name:t})=>t)))],n=O.select(`#select-city-${e}`);n.selectAll("option").data(a).enter().append("option").attr("value",(t=>t)).text((t=>t)),n.on("change",(function(){y()}))}))}const q={select:a,selectAll:n,min:s,max:o,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,format:h};const U={select:a,selectAll:n,min:s,max:o,line:k,scaleTime:u,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,easeLinear:w,format:h,interpolatePath:z};function j(t,e){const a={top:16,right:16,bottom:24,left:62};let n=0,s=0;const o=U.select(`.line-lb-${e}`),c=o.select("svg");let i,r={};function l(){const t=U.scaleTime().domain([2010,2020]),e=U.scaleLinear().domain([U.min(i,(t=>1.75*t.population-t.population)),1.25*U.max(i,(t=>t.population))]);r.count={x:t,y:e}}function p(t){const l=o.node().offsetWidth,{left:p,right:d,top:u,bottom:m}=a;n=l-p-d,s=500-u-m,c.attr("width",l).attr("height",500);const y=`translate(${p},${u})`,g=c.select(`.line-lb-${e}-container`);g.attr("transform",y);const f=U.line().x((t=>r.count.x(t.year))).y((t=>r.count.y(t.population)));!function(t,e){const{count:{x:a,y:n}}=r;a.range([0,t]),n.range([e,0])}(n,s);const x=o.select(`.line-lb-${e}-container-bis`),h=x.selectAll(".lines").data([i]);x.selectAll(".circles-population").remove().exit().data(i);const v=h.enter().append("path").attr("class","lines");h.merge(v).transition().duration(400).ease(U.easeLinear).attrTween("d",(function(t){let e=U.select(this).attr("d"),a=f(t);return U.interpolatePath(e,a)})),function(t){const e=U.axisBottom(r.count.x).tickPadding(5).tickFormat(U.format("d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=U.axisLeft(r.count.y).tickPadding(5).tickFormat(U.format("d")).tickSize(-n).ticks(6);t.select(".axis-y").transition().duration(450).ease(U.easeLinear).call(a)}(g)}function d(){U.csv(t).then((t=>{const a=U.select(`#select-lb-${e}`).property("value");i=t.filter((({municipio:t})=>t===a)),i.forEach((t=>{t.population=+t.population,t.year=+t.year})),l(),p()}))}window.addEventListener("resize",(function(){p()})),U.csv(t).then((t=>{const[{name:a}]=t;i=t.reduce(((t,e)=>(e.municipio===a&&(e.year=+e.year,e.population=+e.population,t.push(e)),t)),[]),function(){const t=c.select(`.line-lb-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-lb-${e}-container-bis`)}(),l(),p(),d()})),U.csv(t).then((t=>{const a=[...new Set(t.map((({municipio:t})=>t)))],n=U.select(`#select-lb-${e}`);n.selectAll("option").data(a).enter().append("option").attr("value",(t=>t)).text((t=>t)),n.on("change",(function(){d()}))}))}const I={select:a,selectAll:n,min:s,max:o,line:k,scaleTime:u,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,easeLinear:w,format:h,interpolatePath:z};function R(t,e){let a,n=0,s=0,o={};const c={top:16,right:16,bottom:24,left:96},i=I.select(`.line-densidad-${e}`),r=i.select("svg");function l(){const t=I.scaleTime().domain([I.min(a,(t=>t.year)),I.max(a,(t=>t.year))]),e=I.scaleLinear().domain([0,I.max(a,(t=>1.5*t.densidad))]);o.count={x:t,y:e}}function p(t){const l=i.node().offsetWidth,{left:p,right:d,top:u,bottom:m}=c;n=l-p-d,s=500-u-m,r.attr("width",l).attr("height",500);const y=`translate(${p},${u})`,g=r.select(`.line-densidad-${e}-container`);g.attr("transform",y);const f=I.line().x((t=>o.count.x(t.year))).y((t=>o.count.y(t.densidad)));!function(t,e){const{count:{x:a,y:n}}=o;a.range([0,t]),n.range([e,0])}(n,s);const x=i.select(`.line-densidad-${e}-container-bis`),h=x.selectAll(".lines").data([a]);x.selectAll(".circles-population").remove().exit().data(a);const v=h.enter().append("path").attr("class","lines");h.merge(v).transition().duration(400).ease(I.easeLinear).attrTween("d",(function(t){let e=I.select(this).attr("d"),a=f(t);return I.interpolatePath(e,a)})),function(t){const e=I.axisBottom(o.count.x).tickPadding(5).tickFormat(I.format("d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${s})`).call(e);const a=I.axisLeft(o.count.y).tickPadding(5).tickFormat((t=>t+" hab/km2")).tickSize(-n).ticks(6);t.select(".axis-y").transition().duration(450).ease(I.easeLinear).call(a)}(g)}function d(){I.csv(t).then((t=>{const n=I.select(`#select-densidad-${e}`).property("value");a=t.filter((({name:t})=>t===n)),a.forEach((t=>{t.population=+t.population,t.year=+t.year,t.superficie=+t.superficie,t.densidad=t.population/t.superficie})),l(),p(),u(a)}))}function u(t){const e=t.map((({densidad:t})=>t));e.some((t=>t<10))&&e[e.length-1]<10?(i.selectAll(".rect-desert-demographic").remove().exit(),i.append("div").attr("class","rect-desert-demographic").html("<span>Una densidad inferior a 10hab/km convierte al municipio en un desierto demógrafico.</span>").style("position","absolute").style("top","50px").style("left","70%")):i.selectAll(".rect-desert-demographic").remove().exit()}window.addEventListener("resize",(function(){p()})),I.csv(t).then((t=>{const[{name:n}]=t;a=t.reduce(((t,e)=>(e.name===n&&(e.year=+e.year,e.population=+e.population,e.superficie=+e.superficie,e.densidad=+e.population/e.superficie,t.push(e)),t)),[]),function(){const t=r.select(`.line-densidad-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-densidad-${e}-container-bis`)}(),l(),p(),d(),u(a)})),I.csv(t).then((t=>{const a=[...new Set(t.map((({name:t})=>t)))],n=I.select(`#select-densidad-${e}`);n.selectAll("option").data(a).enter().append("option").attr("value",(t=>t)).text((t=>t)),n.on("change",(function(){d()}))}))}const X={select:a,selectAll:n,min:s,max:o,scaleLinear:m,axisBottom:g,axisLeft:f,csv:x,format:h,easeLinear:w},D=(t,e)=>{const a={top:24,right:24,bottom:48,left:72};let n,s,o,c,i=0,r=0,l=0,p=0,d=2020;const u=X.select(`.scatter-lb-${e}`),m=u.select("svg"),y={},g=X.select(`.scatter-lb-${e}`).append("div").attr("class","tooltip tooltip-scatter-lb").style("opacity",0);function f(t){l=u.node().offsetWidth,p=600;const{left:n,right:s,top:o,bottom:c}=a;i=l-n-s,r=p-o-c,m.attr("width",l).attr("height",p);const d=`translate(${n},${o})`,f=m.select(`.scatter-lb-${e}-container`);f.attr("transform",d),function(t,e){const{count:{x:a,y:n}}=y;a.range([0,t]),n.range([e,0])}(i,r);const x=u.select(`.scatter-lb-${e}-container-bis`).selectAll(".circle-desert").remove().exit().data(t),h=x.enter().append("circle").attr("class","circle-desert");x.merge(h).attr("cx",(t=>Math.random()*i)).attr("cy",(t=>y.count.y(t.percentage/2))).attr("r",2).on("mouseover",((t,e)=>{const{pageX:a,pageY:n}=t,s=y.count.x(e.cp)+270,o=`${a}px`,c=a-210+"px";g.transition();const i=e.percentage>0?`<p class="tooltip-scatter-text"><strong>${e.name}</strong> aumento su población en un <strong>${e.percentage}%</strong>.<p/>`:0===e.percentage?`<p class="tooltip-scatter-text"><strong>${e.name}</strong> ni aumentado ni disminuyo su población.<p/>`:`<p class="tooltip-scatter-text"><strong>${e.name}</strong> disminuyo su población en un <strong>${e.percentage}%</strong>.<p/>`;g.style("opacity",1).html(`${i}\n            <p class="tooltip-scatter-text">Población en 2010: <strong>${e.populationFirstYear}</strong><p/>\n            <p class="tooltip-scatter-text">Población en 2020: <strong>${e.populationSecondYear}</strong><p/>`).style("left",s>l?c:o).style("top",n-100+"px")})).on("mouseout",(()=>{g.transition().duration(200).style("opacity",0)})).attr("fill-opacity",.8).transition().duration(450).ease(X.easeLinear).attr("cy",(t=>y.count.y(t.percentage))).attr("fill",(t=>t.percentage>=0?"#3b2462":0===t.percentage?"#111":"#B41248")).attr("r",4),function(t){const e=X.axisBottom(y.count.x).tickFormat(X.format("d")).ticks(0);t.select(".axis-x").attr("transform",`translate(0,${r})`).call(e);const a=X.axisLeft(y.count.y).tickFormat((t=>t+"%")).tickSize(-i).ticks(10);t.select(".axis-y").transition().duration(450).ease(X.easeLinear).call(a)}(f)}const x=["2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"];function h(){let t=[],a=v(2010,"populationFirstYear"),n=v(2020,"populationSecondYear");t=a.map(((t,e)=>Object.assign({},t,n[e]))),c=t.map((({populationFirstYear:t,populationSecondYear:e,name:a,cp:n})=>({percentage:+(100*(e-t)/t).toFixed(2),populationFirstYear:t,populationSecondYear:e,cp:n,name:a}))),s=c.filter((({percentage:t})=>t<0)).length,o=c.filter((({percentage:t})=>t>0)).length,X.select(`.municipios-lost-${e}`).remove(),X.select(`.municipios-wins-${e}`).remove(),m.select(`.scatter-lb-${e}-container`).append("text").attr("class",`municipios-lost-${e}`).attr("y","95%").attr("x","5%").text(`${s} municipios han perdido población.`),m.select(`.scatter-lb-${e}-container`).append("text").attr("class",`municipios-wins-${e}`).attr("y","91%").attr("x","5%").text(`${o} municipios han ganado población.`),function(){const t=X.scaleLinear().domain([X.min(c,(t=>t.percentage)),X.max(c,(t=>t.percentage))]),e=X.scaleLinear().domain([X.min(c,(t=>1.25*t.percentage)),X.max(c,(t=>t.percentage))]);y.count={x:t,y:e}}(),f(c)}function v(t,e){return n.filter((({year:e})=>e===t)).map((({population:t,municipio:a,cp:n})=>({[e]:t,name:a,cp:n})))}X.select(`#select-compare-${e}`).on("click",(t=>{h()})),window.addEventListener("resize",(function(){f(c)})),X.csv(t).then((t=>{var a;n=t.map((t=>({year:+t.year,population:+t.population,municipio:t.municipio}))),function(){const t=m.select(`.scatter-lb-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`scatter-lb-${e}-container-bis`),t.append("circle").attr("r",3).attr("fill","#B41248").attr("cy","94%").attr("cx","4%"),t.append("circle").attr("r",3).attr("fill","#3b2462").attr("cy","90%").attr("cx","4%")}(),function(t){const a=X.select(`#select-first-year-${e}`);X.select(`#select-second-year-${e}`).property("value"),a.selectAll("option").remove().exit().data(t).enter().append("option").text((t=>t))}(x),a=x,X.select(`#select-second-year-${e}`).selectAll("option").remove().exit().data(a).enter().append("option").text((t=>t)),X.select(`#select-second-year-${e}`).property("value",d),h()}))},Z={select:a,selectAll:n,min:s,max:o,bisector:c,extent:i,area:l,stack:p,easeLinear:w,stackOrderInsideOut:d,scaleTime:u,scaleLinear:m,scaleOrdinal:y,axisBottom:g,axisLeft:f,csv:x,format:h,group:S,rollup:P,sum:A,interpolatePath:z};function _(t,e){const a={top:40,right:8,bottom:24,left:32};let n,s,o=0,c=0;const i=Z.select(`.municipalities-stack-${e}`),r=i.select("svg"),l={},p=Z.bisector((t=>t.year)).left,d=i.append("div").attr("class","tooltip tooltip-stack").style("opacity",0);function u(t){const e=Z.scaleTime().domain(Z.extent(n,(t=>t.year)));let a=Array.from(new Set(n.map((t=>t.age))).values());const s=Z.stack().keys(a)(t),o=Z.scaleLinear().domain([0,Z.max(s,(t=>Z.max(t,(t=>t[1]))))]);l.count={x:e,y:o}}function m(t){const s=i.node().offsetWidth,{left:u,right:m,top:y,bottom:g}=a;o=s-u-m,c=600-y-g,r.attr("width",s).attr("height",600);const f=`translate(${u},${y})`,x=r.select(`.municipalities-stack-${e}-container`);x.attr("transform",f),x.append("rect").attr("class","overlay-dos"),x.append("g").attr("class","focus").style("display","none").append("line").attr("class","x-hover-line hover-line").attr("y1",0);let h=Array.from(new Set(n.map((t=>t.age))).values());const v=Z.stack().keys(h)(t);let $=[...new Set(n.map((({age:t})=>t)))];const b=Z.area().x((t=>l.count.x(t.data.year))).y0((t=>l.count.y(t[0]))).y1((t=>l.count.y(t[1]))),k=Z.scaleOrdinal().domain($).range(["#9db7c5","#18857f","#05cfc0","#1f4196"]),L=r.selectAll(".label").data(k.domain()).enter().append("g").attr("class","label").attr("transform",((t,e)=>`translate(${54*e}, 10)`));L.append("rect").attr("x",((t,e)=>`${a.left+34*e}`)).attr("y",0).attr("width",16).attr("height",16).style("fill",k),L.append("text").attr("class","legend-text").attr("x",((t,e)=>`${a.left+20+34*e}`)).attr("y",9).attr("dy",".35em").text((t=>`${t} años`)),function(t,e){const{count:{x:a,y:n}}=l;a.range([0,t]),n.range([e,0])}(o,c);const w=i.select(`.municipalities-stack-container-${e}-bis`).selectAll(".area-stack-municipalities").data(v),z=w.enter().append("path").attr("class","area-stack-municipalities");w.merge(z).transition().duration(600).ease(Z.easeLinear).attrTween("d",(function(t){let e=Z.select(this).attr("d"),a=b(t);return Z.interpolatePath(e,a)})).attr("fill",(t=>k(t.key)));const S=x.select(".focus"),P=x.select(".overlay-dos");S.select(".x-hover-line").attr("y2",c),P.attr("width",o+a.left+a.right).attr("height",c).on("mouseover",(function(){S.style("display",null)})).on("mousemove",(function(t){const{layerX:e}=t,s=i.node().offsetWidth;var o=l.count.x.invert(e),c=p(n,o,1),r=n[c-1],u=n[c],m=o-r.year>u.year-o?u:r;const y=l.count.x(m.year)+a.left,g=y+200,f=s-y,x=m.year,h=n.filter((({year:t})=>t===x)).reduce(((t,e)=>(t.push(function(t){const{age:e,total:a}=t;return`<span class="tooltip-stack-text"><b>${e} años:</b> ${a} ${1===a?"habitante":"habitantes"}</span>`}(e)),t)),[]);d.style("opacity",1).html((()=>`\n            <span class="tooltip-stack-year">${x}</span>\n            ${h.join("")}\n          `)).style("top","35%").style("left",g>s?"auto":y+"px").style("right",g>s?f+"px":"auto"),S.select(".x-hover-line").attr("transform",`translate(${l.count.x(m.year)},0)`)})),function(t){const{count:{x:e,y:a}}=l,n=Z.axisBottom(e).tickFormat(Z.format("d")).tickPadding(7).ticks(9);t.select(".axis-x").attr("transform",`translate(0,${c})`).call(n);const s=Z.axisLeft(a).tickFormat((t=>t)).tickSizeInner(-o).ticks(12);t.select(".axis-y").transition().duration(450).ease(Z.easeLinear).call(s)}(x)}function y(){Z.csv(t).then((a=>{const o=[...new Set(a.map((({name:t})=>t)))],c=Z.select(`#select-municipalities-stack-${e}`);c.selectAll("option").data(o).enter().append("option").attr("value",(t=>t)).text((t=>t)),c.on("change",(function(){Z.csv(t).then((t=>{const a=Z.select(`#select-municipalities-stack-${e}`).property("value");n=t.filter((({name:t})=>t===a)),s=g(),u(s),m(s)}))}))}))}function g(){let t=Z.group(n,(t=>t.year),(t=>t.age)),e=Array.from(new Set(n.map((t=>t.age))).values());return Array.from(t.entries()).map((t=>{const a={};a.year=t[0];for(let s of e){const e=t[1].get(s);a[s]=e?(n=Array.from(e.values()),Z.sum(n,(t=>t.total))):0}var n;return a})).sort(((t,e)=>t.year-e.year))}window.addEventListener("resize",(function(){m(g())})),Z.csv(t).then((t=>{const[{name:a}]=t;n=t.filter((({name:t})=>t===a)),s=g(),function(){const t=r.select(`.municipalities-stack-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`municipalities-stack-container-${e}-bis`)}(),y(),u(s),m(s)}))}!function(){const t=document.querySelector(".overlay"),e=document.querySelector(".navegacion"),a=document.querySelector("body"),n=document.querySelectorAll(".navegacion-btn"),s=document.querySelector(".burger");function o(){s.classList.toggle("clicked"),t.classList.toggle("show"),e.classList.toggle("show"),a.classList.toggle("overflow")}document.querySelector(".burger").addEventListener("click",o),document.querySelector(".overlay").addEventListener("click",o);for(let i=0;i<n.length;i++)n[i].addEventListener("click",(function(){c()}));function c(){t.classList.remove("show"),e.classList.remove("show"),s.classList.remove("clicked")}}(),setTimeout(void e.timeline().add({targets:".header-title .letter",translateY:[0,"1.5rem"],translateZ:0,duration:750,delay:e.stagger(500)}).add({targets:".letter",translateY:["1.5rem","2rem"],translateZ:0,rotate:45,duration:750,delay:e.stagger(1e3)}),200),function(){const t={top:24,right:24,bottom:48,left:72};let e=0,a=0,n=0,s=0;const o=q.select(".scatter-desert"),c=o.select("svg"),i={};let r;function l(r){n=o.node().offsetWidth,s=600;const{left:l,right:p,top:d,bottom:u}=t;e=n-l-p,a=s-d-u,c.attr("width",n).attr("height",s);const m=`translate(${l},${d})`,y=c.select(".scatter-desert-container");y.attr("transform",m),function(t,e){const{count:{x:a,y:n}}=i;a.range([0,t]),n.range([e,0])}(e,a);const g=o.select(".scatter-desert-container-bis").selectAll(".circle-desert").data(r),f=g.enter().append("circle").attr("class","circle-desert");g.merge(f).attr("cx",(t=>Math.random()*e)).attr("cy",(t=>i.count.y(t.densidad))).attr("r",3).attr("fill",(t=>t.densidad>=10?"#3b2462":"#B41248")).attr("fill-opacity",.8),function(t){const{count:{x:n,y:s}}=i,o=q.axisBottom(n).tickFormat(q.format("d")).ticks(0);t.select(".axis-x").attr("transform",`translate(0,${a})`).call(o);const c=q.axisLeft(s).tickFormat((t=>t+" hab/km2")).tickSize(-e).ticks(10);t.select(".axis-y").call(c)}(y)}window.addEventListener("resize",(function(){l(r)})),q.csv("data/aragon-municipios.csv").then((t=>{r=t,function(){const t=c.select(".scatter-desert-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","scatter-desert-container-bis"),t.append("circle").attr("r",3).attr("fill","#B41248").attr("cy","94%").attr("cx","4%"),t.append("text").text("Municipios con una densidad inferior a 10hab/km2").attr("y","95%").attr("x","5%")}(),function(){const t=q.scaleLinear().domain([q.min(r,(t=>t.densidad)),q.max(r,(t=>t.densidad))]),e=q.scaleLinear().domain([q.min(r,(t=>t.densidad)),q.max(r,(t=>t.densidad))]);i.count={x:t,y:e}}(),l(r)}))}(),function(){const t={top:24,right:8,bottom:24,left:32};let e=0,a=0;const n=C.select(".aragon-stack"),s=n.select("svg"),o={};let c;const i=C.bisector((t=>t.year)).left,r=n.append("div").attr("class","tooltip tooltip-stack").style("opacity",0);function l(c){const l=n.node().offsetWidth,{left:p,right:d,top:u,bottom:m}=t;e=l-p-d,a=600-u-m,s.attr("width",l).attr("height",600);const y=`translate(${p},${u})`,g=s.select(".aragon-stack-container");g.attr("transform",y),g.append("rect").attr("class","overlay-dos"),g.append("g").attr("class","focus").style("display","none").append("line").attr("class","x-hover-line hover-line").attr("y1",0);const f=c.columns.slice(5),x=C.area().x((t=>o.count.x(t.data.year))).y0((t=>o.count.y(t[0]))).y1((t=>o.count.y(t[1]))).curve(C.curveCardinal.tension(.6)),h=C.stack().keys(f).order(C.stackOrderInsideOut)(c),v=C.scaleOrdinal().domain(f).range(["#F67460","#C54073","#5A1C7C"]);!function(t,e){const{count:{x:a,y:n}}=o;a.range([0,t]),n.range([e,0])}(e,a);const $=n.select(".aragon-stack-container-bis").selectAll(".area-stack").data(h),b=$.enter().append("path").attr("class","area-stack");$.merge(b).attr("fill",(t=>v(t.key))).attr("d",x);const k=g.select(".focus"),L=g.select(".overlay-dos");k.select(".x-hover-line").attr("y2",a),L.attr("width",e+p+d).attr("height",a).on("mouseover",(function(){k.style("display",null)})).on("mouseout",(function(){k.style("display","none"),r.style("opacity",0)})).on("mousemove",(function(e){const{layerX:a}=e,s=n.node().offsetWidth;var l=o.count.x.invert(a),p=i(c,l,1),d=c[p-1],u=c[p],m=l-d.year>u.year-l?u:d;const y=o.count.x(m.year)+t.left,g=y+200,f=s-y;r.style("opacity",1).html(`\n          <span class="tooltip-stack-number tooltip-stack-text">${m.year}</span>\n          <span class="tooltip-stack-text">Huesca: <span class="tooltip-number">${m.huescaP}% - ${m.huesca} hab.</span></span>\n          <span class="tooltip-stack-text">Teruel: <span class="tooltip-number">${m.teruelP}% - ${m.teruel} hab.</span></span>\n          <span class="tooltip-stack-text">Zaragoza: <span class="tooltip-number">${m.zaragozaP}% - ${m.zaragoza} hab.</span></span>\n          <span class="tooltip-stack-text">Total: <span class="tooltip-number">${m.aragon} hab.</span></span>\n          `).style("top","35%").style("left",g>s?"auto":y+"px").style("right",g>s?f+"px":"auto"),k.select(".x-hover-line").attr("transform",`translate(${o.count.x(m.year)},0)`)})),function(t){const n=C.axisBottom(o.count.x).tickFormat(C.format("d")).tickPadding(7).ticks(9);t.select(".axis-x").attr("transform",`translate(0,${a})`).call(n);const s=C.axisLeft(o.count.y).tickFormat((t=>t+"%")).tickSizeInner(-e).ticks(12);t.select(".axis-y").call(s)}(g)}window.addEventListener("resize",(function(){l(c)})),C.csv("data/aragon-total.csv").then((t=>{c=t,function(){const t=s.select(".aragon-stack-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","aragon-stack-container-bis"),t.append("text").attr("class","legend-aragon").attr("y","70%").attr("x","1%").text("Zaragoza"),t.append("text").attr("class","legend-aragon").attr("y","5%").attr("x","1%").text("Huesca"),t.append("text").attr("class","legend-aragon").attr("y","30%").attr("x","1%").text("Teruel")}(),function(){const t=C.scaleTime().domain(C.extent(c,(t=>t.year))),e=C.scaleLinear().domain([0,100]);o.count={x:t,y:e}}(),l(c)}))}(),function(){const t=document.querySelector("#aragones"),e=document.querySelector("#castellano"),a=document.querySelector(".aragones"),n=document.querySelector(".castellano");t.onclick=function(){n.classList.remove("active"),a.classList.remove("hidden"),a.classList.toggle("active"),n.classList.toggle("hidden"),t.classList.remove("active"),e.classList.remove("hidden"),t.classList.toggle("hidden"),e.classList.toggle("active")},e.onclick=function(){a.classList.remove("active"),n.classList.remove("hidden"),n.classList.toggle("active"),a.classList.toggle("hidden"),e.classList.remove("active"),t.classList.remove("hidden"),e.classList.toggle("hidden"),t.classList.toggle("active")}}(),[{city:"huesca",linePopulationCSV:"data/huesca/huesca.csv",lineTotalCSV:"data/huesca/huesca-total.csv",scatterUnderCSV:"data/huesca/huesca-mayor-menor.csv",vegetativeCSV:"data/huesca/saldo-vegetativo-total-huesca.csv",comparatorCSV:"data/evolucion/huesca/huesca-total.csv",evolutionCSV:"data/huesca/huesca-2010-2020.csv",groupByAgeCSV:"data/data2020/huesca-years-groups-total.csv",densityCSV:"data/huesca/huesca-densidad.csv"},{city:"teruel",linePopulationCSV:"data/teruel/teruel.csv",lineTotalCSV:"data/teruel/teruel-total.csv",scatterUnderCSV:"data/teruel/teruel-mayor-menor.csv",vegetativeCSV:"data/teruel/saldo-vegetativo-total-teruel.csv",comparatorCSV:"data/evolucion/teruel/teruel-total.csv",evolutionCSV:"data/teruel/teruel-2010-2020.csv",groupByAgeCSV:"data/data2020/teruel-years-groups-total.csv",densityCSV:"data/teruel/teruel-densidad.csv"},{city:"zaragoza",linePopulationCSV:"data/zaragoza/zaragoza.csv",lineTotalCSV:"data/zaragoza/zaragoza-total.csv",scatterUnderCSV:"data/zaragoza/zaragoza-mayor-menor.csv",vegetativeCSV:"data/zaragoza/saldo-vegetativo-total-zaragoza.csv",comparatorCSV:"data/evolucion/zaragoza/zaragoza-total.csv",evolutionCSV:"data/zaragoza/zaragoza-2010-2020.csv",groupByAgeCSV:"data/data2020/zaragoza-years-groups-total.csv",densityCSV:"data/zaragoza/zaragoza-densidad.csv"}].map((t=>{const{city:e,linePopulationCSV:a,lineTotalCSV:n,scatterUnderCSV:s,vegetativeCSV:o,comparatorCSV:c,evolutionCSV:i,groupByAgeCSV:r,densityCSV:l}=t;Y(a,e),W(n,e),V(s,e),T(o,e),j(i,e),D(i,e),_(r,e),R(l,e)}));
