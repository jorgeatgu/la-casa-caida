function menu(){var t=document.querySelector(".overlay"),e=document.querySelector(".navegacion"),a=document.querySelector("body"),n=document.querySelectorAll(".navegacion-btn"),c=document.querySelector(".burger");function o(){c.classList.toggle("clicked"),t.classList.toggle("show"),e.classList.toggle("show"),a.classList.toggle("overflow")}for(document.querySelector(".burger").addEventListener("click",o),document.querySelector(".overlay").addEventListener("click",o),i=0;i<n.length;i++)n[i].addEventListener("click",function(){s()});function s(){t.classList.remove("show"),e.classList.remove("show"),c.classList.remove("clicked")}}const csvLB=["data/evolucion/huesca/huesca-total.csv","data/evolucion/teruel/teruel-total.csv","data/evolucion/zaragoza/zaragoza-total.csv"],cities=["huesca","teruel","zaragoza"],lineLB=(t,e)=>{const a={top:16,right:16,bottom:24,left:62};let n=0,c=0;const o=d3.select(`.line-lb-${e}`),s=o.select("svg");let i,l={};const r=(t,e)=>{l.count.x.range([0,t]),l.count.y.range([e,0])},d=t=>{const e=d3.axisBottom(l.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${c})`).transition().duration(300).ease(d3.easeLinear).call(e);const a=d3.axisLeft(l.count.y).tickPadding(5).tickFormat(d3.format("d")).tickSize(-n).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(a)};function p(t){const p=o.node().offsetWidth;n=p-a.left-a.right,c=500-a.top-a.bottom,s.attr("width",p).attr("height",500);const u=`translate(${a.left},${a.top})`,g=s.select(`.line-lb-${e}-container`);g.attr("transform",u);const m=d3.line().x(t=>l.count.x(t.year)).y(t=>l.count.y(t.population)).curve(d3.curveCardinal.tension(.6));r(n,c);const x=o.select(`.line-lb-${e}-container-bis`),y=x.selectAll(".lines").data([i]),v=x.selectAll(".circles-population").remove().exit().data(i),h=y.enter().append("path").attr("class","lines");y.merge(h).transition().duration(400).ease(d3.easeLinear).attrTween("d",function(t){var e=d3.select(this).attr("d"),a=m(t);return d3.interpolatePath(e,a)});const f=v.enter().append("circle").attr("class","circles-population").attr("fill","#531f4e");v.merge(f).attr("cx",t=>l.count.x(t.year)).attr("cy",t=>l.count.y(t.population)).attr("r",0).transition().duration(400).ease(d3.easeLinear).attr("cx",t=>l.count.x(t.year)).attr("cy",t=>l.count.y(t.population)).attr("r",4),d(g)}function u(a){d3.csv(t,(t,a)=>{i=a;let o=d3.select(`#select-lb-${e}`).property("value"),s=new RegExp("^"+o+"$");(i=i.filter(t=>String(t.name).match(s))).forEach(t=>{t.population=+t.population,t.year=+t.year}),l.count.x.range([0,n]),l.count.y.range([c,0]);const r=d3.scaleTime().domain([2011,2019]),d=d3.scaleLinear().domain([d3.min(i,t=>1.75*t.population-t.population),1.25*d3.max(i,t=>t.population)]);l.count={x:r,y:d},p()})}window.addEventListener("resize",()=>{p()}),d3.csv(t,(t,a)=>{t?console.log(t):((i=a).forEach(t=>{t.year=+t.year,t.population=+t.population,t.cp=+t.cp}),(()=>{const t=s.select(`.line-lb-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-lb-${e}-container-bis`)})(),(()=>{const t=d3.scaleTime().domain([2011,2019]),e=d3.scaleLinear().domain([d3.min(i,t=>1.75*t.population-t.population),1.25*d3.max(i,t=>t.population)]);l.count={x:t,y:e}})(),p(),i[0].name,u())}),d3.csv(t,(t,a)=>{if(t)console.log(t);else{i=a;const t=d3.nest().key(t=>t.name).entries(i),n=d3.select(`#select-lb-${e}`);n.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),n.on("change",function(){d3.select(this).property("value"),u()})}})};lineLB(csvLB[0],cities[0]),lineLB(csvLB[1],cities[1]),lineLB(csvLB[2],cities[2]),new SlimSelect({select:"#select-lb-huesca",searchPlaceholder:"Busca tu municipio"}),new SlimSelect({select:"#select-lb-zaragoza",searchPlaceholder:"Busca tu municipio"}),new SlimSelect({select:"#select-lb-teruel",searchPlaceholder:"Busca tu municipio"}),menu();const scatterLB=(t,e)=>{const a=24,n=24,c=48,o=72;let s=0,i=0,l=0,r=0;const d=d3.select(`.scatter-lb-${e}`),p=d.select("svg"),u={};let g,m,x;const y=d3.select(`.scatter-lb-${e}`).append("div").attr("class","tooltip tooltip-scatter-lb").style("opacity",0),v=t=>{l=d.node().offsetWidth,s=l-o-n,i=(r=600)-a-c,p.attr("width",l).attr("height",r);const g=`translate(${o},${a})`,m=p.select(`.scatter-lb-${e}-container`);m.attr("transform",g),((t,e)=>{u.count.x.range([0,t]),u.count.y.range([e,0])})(s,i);const x=d.select(`.scatter-lb-${e}-container-bis`).selectAll(".circle-desert").data(t),v=x.enter().append("circle").attr("class","circle-desert");x.merge(v).attr("cx",t=>Math.random()*s).attr("cy",t=>u.count.y(t.percentage)).attr("r",4).on("mouseover",t=>{const e=u.count.x(t.cp)+270,a=`${d3.event.pageX}px`,n=`${d3.event.pageX-210}px`;y.transition(),t.percentage>0?y.style("opacity",1).html(`<p class="tooltip-scatter-text"><strong>${t.name}</strong> ha aumentado su población un <strong>${t.percentage}%</strong>.<p/>\n                      <p class="tooltip-scatter-text">Población en 2018: <strong>${t.dosmildieciocho}</strong><p/>\n                      <p class="tooltip-scatter-text">Población en 2019: <strong>${t.dosmildiecinueve}</strong><p/>\n                      `).style("left",e>l?n:a).style("top",`${d3.event.pageY-100}px`):0===t.percentage?y.style("opacity",1).html(`<p class="tooltip-scatter-text"><strong>${t.name}</strong> no ha aumentado ni disminuido su población.<p/>\n                      <p class="tooltip-scatter-text">Población en 2018: <strong>${t.dosmildieciocho}</strong><p/>\n                      <p class="tooltip-scatter-text">Población en 2019: <strong>${t.dosmildiecinueve}</strong><p/>\n                      `).style("left",e>l?n:a).style("top",`${d3.event.pageY-100}px`):y.style("opacity",1).html(`<p class="tooltip-scatter-text"><strong>${t.name}</strong> ha disminuido su población un <strong>${t.percentage}%</strong>.<p/>\n                      <p class="tooltip-scatter-text">Población en 2018: <strong>${t.dosmildieciocho}</strong><p/>\n                      <p class="tooltip-scatter-text">Población en 2019: <strong>${t.dosmildiecinueve}</strong><p/>\n                      `).style("left",e>l?n:a).style("top",`${d3.event.pageY-100}px`)}).on("mouseout",()=>{y.transition().duration(200).style("opacity",0)}).attr("fill",t=>t.percentage>=0?"#3b2462":0===t.percentage?"#111":"#B41248").attr("fill-opacity",.8),(t=>{const e=d3.axisBottom(u.count.x).tickFormat(d3.format("d")).ticks(0);t.select(".axis-x").attr("transform",`translate(0,${i})`).call(e);const a=d3.axisLeft(u.count.y).tickFormat(t=>t+"%").tickSize(-s).ticks(10);t.select(".axis-y").call(a)})(m)};window.addEventListener("resize",()=>{v(g)}),d3.csv(t,(t,a)=>{t?console.log(t):((g=a).forEach(t=>{t.cp=t.cp,t.percentage=+t.percentage,t.dosmildieciocho=+t.dosmildieciocho,t.dosmildiecinueve=+t.dosmildiecinueve}),m=g.filter(t=>t.percentage<0),x=g.filter(t=>t.percentage>0),(()=>{const t=p.select(`.scatter-lb-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`scatter-lb-${e}-container-bis`),t.append("circle").attr("r",3).attr("fill","#B41248").attr("cy","94%").attr("cx","4%"),t.append("circle").attr("r",3).attr("fill","#3b2462").attr("cy","90%").attr("cx","4%"),t.append("text").text(`Municipios que han perdido población. Total: ${m.length}`).attr("y","95%").attr("x","5%"),t.append("text").text(`Municipios que han ganado población. Total: ${x.length}`).attr("y","91%").attr("x","5%")})(),(()=>{const t=d3.scaleLinear().domain([d3.min(g,t=>t.percentage),d3.max(g,t=>t.percentage)]),e=d3.scaleLinear().domain([d3.min(g,t=>1.25*t.percentage),d3.max(g,t=>t.percentage)]);u.count={x:t,y:e}})(),v(g))})},csvBalance=["data/huesca/2018-2019-huesca.csv","data/teruel/2018-2019-teruel.csv","data/zaragoza/2018-2019-zaragoza.csv"];scatterLB(csvBalance[0],cities[0]),scatterLB(csvBalance[1],cities[1]),scatterLB(csvBalance[2],cities[2]);