const widthMobile=window.innerWidth>0?window.innerWidth:screen.width;function menu(){var t=document.querySelector(".overlay"),e=document.querySelector(".navegacion"),a=document.querySelector("body"),c=document.querySelectorAll(".navegacion-btn"),n=document.querySelector(".burger");function o(){n.classList.toggle("clicked"),t.classList.toggle("show"),e.classList.toggle("show"),a.classList.toggle("overflow")}for(document.querySelector(".burger").addEventListener("click",o),document.querySelector(".overlay").addEventListener("click",o),i=0;i<c.length;i++)c[i].addEventListener("click",function(){s(),console.log("click")});function s(){t.classList.remove("show"),e.classList.remove("show"),n.classList.remove("clicked")}}const csvLB=["data/2015-2018/huesca/huesca-total.csv","data/2015-2018/teruel/teruel-total.csv","data/2015-2018/zaragoza/zaragoza-total.csv"],cities=["huesca","teruel","zaragoza"],lineLB=(t,e)=>{const a={top:16,right:16,bottom:24,left:62};let c=0,n=0;const i=d3.select(`.line-lb-${e}`),o=i.select("svg");let s,r={};const l=(t,e)=>{r.count.x.range([0,t]),r.count.y.range([e,0])},d=t=>{const e=d3.axisBottom(r.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${n})`).transition().duration(300).ease(d3.easeLinear).call(e);const a=d3.axisLeft(r.count.y).tickPadding(5).tickFormat(d3.format("d")).tickSize(-c).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(a)};function u(t){const u=i.node().offsetWidth;c=u-a.left-a.right,n=500-a.top-a.bottom,o.attr("width",u).attr("height",500);const p=`translate(${a.left},${a.top})`,m=o.select(`.line-lb-${e}-container`);m.attr("transform",p);const g=d3.line().x(t=>r.count.x(t.year)).y(t=>r.count.y(t.population));l(c,n);const y=i.select(`.line-lb-${e}-container-bis`),f=y.selectAll(".lines").data([s]),h=y.selectAll(".circles-population").remove().exit().data(s),x=f.enter().append("path").attr("class","lines");f.merge(x).transition().duration(400).ease(d3.easeLinear).attrTween("d",function(t){var e=d3.select(this).attr("d"),a=g(t);return d3.interpolatePath(e,a)});const v=h.enter().append("circle").attr("class","circles-population").attr("fill","#531f4e");h.merge(v).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.population)).attr("r",0).transition().duration(400).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.population)).attr("r",4),d(m)}function p(a){d3.csv(t,(t,a)=>{s=a;let i=d3.select(`#select-lb-${e}`).property("value"),o=new RegExp("^"+i+"$");(s=s.filter(t=>String(t.name).match(o))).forEach(t=>{t.population=+t.population,t.year=+t.year}),r.count.x.range([0,c]),r.count.y.range([n,0]);const l=d3.scaleTime().domain([2011,2018]),d=d3.scaleLinear().domain([d3.min(s,t=>1.1*t.population-t.population),1.25*d3.max(s,t=>t.population)]);r.count={x:l,y:d},u()})}window.addEventListener("resize",()=>{u()}),d3.csv(t,(t,a)=>{t?console.log(t):((s=a).forEach(t=>{t.year=+t.year,t.population=+t.population,t.cp=+t.cp}),(()=>{const t=o.select(`.line-lb-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-lb-${e}-container-bis`)})(),(()=>{const t=d3.scaleTime().domain([2011,2018]),e=d3.scaleLinear().domain([d3.min(s,t=>1.5*t.population-t.population),1.25*d3.max(s,t=>t.population)]);r.count={x:t,y:e}})(),u(),s[0].name,p())}),d3.csv(t,(t,a)=>{if(t)console.log(t);else{s=a;const t=d3.nest().key(t=>t.name).entries(s),c=d3.select(`#select-lb-${e}`);c.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),c.on("change",function(){d3.select(this).property("value"),p()})}})};lineLB(),lineLB(csvLB[0],cities[0]),lineLB(csvLB[1],cities[1]),lineLB(csvLB[2],cities[2]);const scatterLB=()=>{const t=24,e=24,a=24,c=32;let n=0,i=0,o=0,s=0;const r=d3.select(".chart-lluvia-scatter"),l=r.select("svg"),d={};let u;const p=u=>{o=r.node().offsetWidth,n=o-c-e,i=(s=600)-t-a,l.attr("width",o).attr("height",s);const p=`translate(${c},${t})`,m=l.select(".chart-lluvia-scatter-container");m.attr("transform",p),((t,e)=>{d.count.x.range([0,t]),d.count.y.range([e,20])})(n,i);const g=r.select(".area-container-chart-scatter").selectAll(".scatter-circles").data(u),y=g.enter().append("circle").attr("class","scatter-circles");g.merge(y).attr("cx",t=>d.count.x(t.cp)).attr("cy",t=>d.count.y(t.diferencia)).attr("r",6).attr("fill-opacity",.6).attr("fill",t=>t.diferencia>0?"#000":0===t.diferencia?"#ccc":"#9A312F"),(t=>{const e=d3.axisBottom(d.count.x).tickFormat(d3.format("d")).ticks(20);t.select(".axis-x").attr("transform",`translate(0,${i})`).call(e);const a=d3.axisLeft(d.count.y).tickFormat(function(t){return t+"%"}).tickSize(-n).ticks(5);t.select(".axis-y").call(a)})(m)};window.addEventListener("resize",()=>{p(u)}),d3.csv("csv/teruel2015-2018.csv",(t,e)=>{t?console.log(t):((u=e).forEach(t=>{t.diferencia=+t.diferencia,t.year15=+t.year15,t.year18=+t.year18}),(()=>{const t=l.select(".chart-lluvia-scatter-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","area-container-chart-scatter")})(),(()=>{const t=d3.scaleLinear().domain(d3.extent(u,t=>t.cp)),e=d3.scaleLinear().domain([d3.min(u,function(t){return t.diferencia}),d3.max(u,function(t){return t.diferencia})]);d.count={x:t,y:e}})(),p(u))})};new SlimSelect({select:"#select-lb-huesca",searchPlaceholder:"Busca tu municipio"}),new SlimSelect({select:"#select-lb-zaragoza",searchPlaceholder:"Busca tu municipio"}),new SlimSelect({select:"#select-lb-teruel",searchPlaceholder:"Busca tu municipio"}),menu(),scatterLB();