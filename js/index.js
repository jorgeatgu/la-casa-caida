function animation(){anime.timeline().add({targets:".header-title .letter",translateY:[0,"1.5rem"],translateZ:0,duration:750,delay:anime.stagger(500)}).add({targets:".letter",translateY:["1.5rem","2rem"],translateZ:0,rotate:45,duration:750,delay:anime.stagger(1e3)})}animation(),csvTotal=["data/huesca/huesca-total.csv","data/teruel/teruel-total.csv","data/zaragoza/zaragoza-total.csv"],csvUnder=["data/huesca/huesca-mayor-menor.csv","data/teruel/mayor-menor-teruel.csv","data/zaragoza/zaragoza-mayor-menor.csv"],csvBalance=["data/huesca/saldo-vegetativo-total-huesca.csv","data/teruel/saldo-vegetativo-total-teruel.csv"],cities=["huesca","teruel","zaragoza"];const line=(t,a)=>{const e=0,s=24,n=24,o=72;let c=0,i=0;const r=d3.select(`.line-${a}`),l=r.select("svg"),d={};let p;var u=d3.formatDefaultLocale({decimal:",",thousands:".",grouping:[3]});u.format(",.3f");const m=t=>{const p=r.node().offsetWidth;c=p-o-s,i=550-e-n,l.attr("width",p).attr("height",550);const m="translate("+o+","+e+")",g=l.select(`.line-${a}-container`);g.attr("transform",m);const y=d3.line().x(t=>d.count.x(t.year)).y(t=>d.count.y(t.total)).curve(d3.curveBasis);((t,a)=>{d.count.x.range([0,t]),d.count.y.range([a,0])})(c,i);const x=r.select(`.line-${a}-container-bis`).selectAll(".line").data([t]),v=x.enter().append("path").attr("class","line").attr("stroke-width","1.5");x.merge(v).attr("d",y),(t=>{const a=d3.axisBottom(d.count.x).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+i+")").call(a);const e=d3.axisLeft(d.count.y).tickFormat(u.format(",.0f")).ticks(6).tickSizeInner(-c);t.select(".axis-y").call(e)})(g)};window.addEventListener("resize",()=>{m(p)}),d3.csv(t,(t,e)=>{t?console.log(t):((p=e).forEach(t=>{t.year=t.year,t.total=t.total}),(()=>{const t=l.select(`.line-${a}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-${a}-container-bis`)})(),(()=>{const t=d3.scaleTime().domain([d3.min(p,t=>t.year),d3.max(p,t=>t.year)]),a=d3.scaleLinear().domain([d3.min(p,t=>t.total/1.25),d3.max(p,t=>1.25*t.total)]);d.count={x:t,y:a}})(),m(p))})},barscatter=(t,a)=>{const e=24,s=24,n=62,o=62;let c=0,i=0,r=0,l=0;const d=d3.select(`.scatter-${a}`),p=d.select("svg"),u={};let m;const g=d.append("div").attr("class","tooltip tooltip-under-over").attr("id","tooltip-scatter").style("opacity",0),y=t=>{r=d.node().offsetWidth,c=r-o-s,i=(l=600)-e-n,p.attr("width",r).attr("height",l);const m="translate("+o+","+e+")",y=p.select(`.scatter-${a}-container`);y.attr("transform",m),((t,a)=>{u.count.x.range([0,t]),u.count.y.range([a,20])})(c,i);const x=d.select(`.scatter-${a}-container-bis`).selectAll(".scatter-circles").data(t),v=x.enter().append("circle").attr("class","scatter-circles");x.merge(v).on("mouseover",function(t){const a=document.getElementById("tooltip-scatter").offsetWidth;console.log(a),g.transition(),g.style("opacity",1).html(`<p class="tooltip-citi">${t.city}<p/>\n                        <p class="tootlip-population">Habitantes: <span class="tooltip-number">${t.population}</span><p/>\n                        <p class="tootlip-over">Mayores de 65: <span class="tooltip-number">${t.mayor}%</span><p/>\n                        <p class="tootlip-under">Menores de 18: <span class="tooltip-number">${t.menor}%</span><p/>\n                        `).style("left",r/2-150+"px").style("top","100px")}).on("mouseout",function(t){g.transition().duration(200).style("opacity",0)}).attr("cx",t=>u.count.x(t.mayor)).attr("cy",t=>u.count.y(t.menor)).attr("r",6),(t=>{const a=d3.axisBottom(u.count.x).tickFormat(t=>t+"%").tickPadding(11).ticks(10);t.select(".axis-x").attr("transform","translate(0,"+i+")").call(a);const e=d3.axisLeft(u.count.y).tickFormat(t=>t+"%").tickSize(-c).ticks(5);t.select(".axis-y").call(e)})(y)};window.addEventListener("resize",()=>{y(m)}),d3.csv(t,(t,e)=>{t?console.log(t):((m=e).forEach(t=>{t.mayor=+t.mayor,t.menor=+t.menor,t.population=+t.population,t.city=t.name}),(()=>{const t=p.select(`.scatter-${a}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`scatter-${a}-container-bis`),t.append("text").attr("class","legend").attr("y","94%").attr("x","35%").style("text-anchor","start").text("Mayores de 65 años"),t.append("text").attr("class","legend").attr("x","-350").attr("y","-50").attr("transform","rotate(-90)").style("text-anchor","start").text("Menores de 18 años")})(),(()=>{const t=d3.scaleLinear().domain([0,70]),a=d3.scaleLinear().domain([0,d3.max(m,t=>1.75*t.menor)]);u.count={x:t,y:a}})(),y(m))})},barNegative=(t,a)=>{const e=24,s=24,n=24,o=48;let c=0,i=0,r=0,l=0;const d=d3.select(`.bar-negative-${a}`),p=d.select("svg"),u={};let m;const g=d.append("div").attr("class","tooltip tooltip-negative").style("opacity",0),y=t=>{r=d.node().offsetWidth,c=r-o-s,i=(l=600)-e-n,p.attr("width",r).attr("height",l);const m="translate("+o+","+e+")",y=p.select(`.bar-negative-${a}-container`);y.attr("transform",m),((t,a)=>{u.count.x.rangeRound([0,t]).paddingInner(.2),u.count.y.range([0,a])})(c,i);const x=d.select(`.bar-negative-${a}-container-bis`).selectAll(".bar-vertical").data(t),v=x.enter().append("rect").attr("class",t=>t.saldo<0?"negative":"positive");x.merge(v).on("mouseover",function(t){g.transition(),g.style("opacity",1).html(`\n                        <p class="tooltip-year"><span class="tooltip-number">${t.year}</span><p/>\n                        <p class="tooltip-born">Nacidos: <span class="tooltip-number">${t.nacidos}</span><p/>\n                        <p class="tooltip-deceased">Fallecidos: <span class="tooltip-number">${t.fallecidos}</span><p/>\n                        <p class="tooltip-deceased">Saldo: <span class="tooltip-number">${t.saldo}</span><p/>\n                        `).style("left",r/2-100+"px").style("top","50px")}).on("mouseout",function(t){g.transition().duration(200).style("opacity",0)}).attr("width",t=>u.count.x.bandwidth()).attr("x",t=>u.count.x(t.year)).attr("y",t=>t.saldo>0?u.count.y(t.saldo):u.count.y(0)).attr("height",t=>Math.abs(u.count.y(t.saldo)-u.count.y(0))),(t=>{const a=d3.axisBottom(u.count.x).ticks(3).tickPadding(8).tickFormat(d3.format("d"));t.select(".axis-x").attr("transform","translate(0,"+i+")").call(a);const e=d3.axisLeft(u.count.y).tickFormat(d3.format("d")).ticks(5).tickSize(-c).tickPadding(8);t.select(".axis-y").call(e)})(y)};window.addEventListener("resize",()=>{y(m)}),d3.csv(t,(t,e)=>{t?console.log(t):((m=e).forEach(t=>{t.year=t.year,t.saldo=t.saldo,t.nacidos=t.nacidos,t.fallecidos=t.fallecidos}),(()=>{const t=p.select(`.bar-negative-${a}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`bar-negative-${a}-container-bis`)})(),(()=>{const t=d3.scaleBand().domain(m.map(t=>t.year)),a=d3.scaleLinear().domain([500,1.25*d3.max(m,t=>t.saldo)]);u.count={x:t,y:a}})(),y(m))})},barNegativeZ=()=>{const t=24,a=24,e=24,s=48;let n=0,o=0,c=0,i=0;const r=d3.select(".bar-negative-zaragoza"),l=r.select("svg"),d={};let p;const u=r.append("div").attr("class","tooltip tooltip-negative").style("opacity",0),m=p=>{c=r.node().offsetWidth,n=c-s-a,o=(i=600)-t-e,l.attr("width",c).attr("height",i);const m="translate("+s+","+t+")",g=l.select(".bar-negative-zaragoza-container");g.attr("transform",m),((t,a)=>{d.count.x.rangeRound([0,t]).paddingInner(.1),d.count.y.range([a,0])})(n,o);const y=r.select(".bar-negative-zaragoza-container-bis").selectAll(".bar-vertical").data(p),x=y.enter().append("rect").attr("class",t=>t.saldo<0?"negative":"positive");y.merge(x).on("mouseover",function(t){u.transition(),u.style("opacity",1).html(`\n                        <p class="tooltip-year"><span class="tooltip-number">${t.year}</span><p/>\n                        <p class="tooltip-born">Nacidos: <span class="tooltip-number">${t.nacidos}</span><p/>\n                        <p class="tooltip-deceased">Fallecidos: <span class="tooltip-number">${t.fallecidos}</span><p/>\n                        <p class="tooltip-deceased">Saldo: <span class="tooltip-number">${t.saldo}</span><p/>\n                        `).style("left",d3.event.pageX-c/2+"px").style("top",i-d.count.y(t.saldo)+"px")}).on("mouseout",function(t){u.transition().duration(200).style("opacity",0)}).attr("width",d.count.x.bandwidth()).attr("x",t=>d.count.x(t.year)).attr("y",t=>t.saldo>0?d.count.y(t.saldo):d.count.y(0)).attr("height",t=>Math.abs(d.count.y(t.saldo)-d.count.y(0))),(t=>{const a=d3.axisBottom(d.count.x).tickPadding(8).tickFormat(d3.format("d"));t.select(".axis-x").attr("transform","translate(0,"+o+")").call(a);const e=d3.axisLeft(d.count.y).tickFormat(d3.format("d")).ticks(5).tickSize(-n).tickPadding(8);t.select(".axis-y").call(e)})(g)};window.addEventListener("resize",()=>{m(p)}),d3.csv("data/zaragoza/saldo-vegetativo-total-zaragoza.csv",(t,a)=>{t?console.log(t):((p=a).forEach(t=>{t.year=t.year,t.saldo=t.saldo}),(()=>{const t=l.select(".bar-negative-zaragoza-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","bar-negative-zaragoza-container-bis")})(),(()=>{const t=d3.scaleBand().domain(p.map(t=>t.year)),a=d3.scaleLinear().domain([d3.min(p,t=>1.25*t.saldo),d3.max(p,t=>2.5*t.saldo)]);d.count={x:t,y:a}})(),m(p))})};barNegativeZ(),line(csvTotal[0],cities[0]),line(csvTotal[1],cities[1]),line(csvTotal[2],cities[2]),barscatter(csvUnder[0],cities[0]),barscatter(csvUnder[1],cities[1]),barscatter(csvUnder[2],cities[2]),barNegative(csvBalance[0],cities[0]),barNegative(csvBalance[1],cities[1]);const vulturno=()=>{const t=window.innerWidth>0?window.innerWidth:screen.width;margin=t>544?{top:16,right:16,bottom:24,left:48}:{top:16,right:16,bottom:24,left:32};let a=0,e=0;const s=d3.select(".line-population-teruel"),n=s.select("svg");let o,c={};const i=(t,a)=>{c.count.x.range([0,t]),c.count.y.range([a,0])},r=t=>{const s=d3.axisBottom(c.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+e+")").transition().duration(300).ease(d3.easeLinear).call(s);const n=d3.axisLeft(c.count.y).tickPadding(5).tickFormat(d3.format("d")).tickSize(-a).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(n)};function l(t){const l=s.node().offsetWidth;a=l-margin.left-margin.right,e=500-margin.top-margin.bottom,n.attr("width",l).attr("height",500);const d="translate("+margin.left+","+margin.top+")",p=n.select(".line-population-teruel-container");p.attr("transform",d);const u=d3.line().x(t=>c.count.x(t.year)).y(t=>c.count.y(t.population));i(a,e);const m=s.select(".line-population-teruel-container-bis").selectAll(".lines").data([o]),g=m.enter().append("path").attr("class","lines");m.merge(g).transition().duration(600).ease(d3.easeLinear).attr("d",u),r(p)}function d(t){d3.csv("data/teruel/teruel.csv",(t,s)=>{o=s;let n=d3.select("#select-city").property("value");(o=o.filter(t=>String(t.name).match(n))).forEach(t=>{t.population=+t.population,t.year=+t.year}),console.log(o),c.count.x.range([0,a]),c.count.y.range([e,0]);const i=d3.scaleTime().domain([d3.min(o,t=>t.year),d3.max(o,t=>t.year)]),r=d3.scaleLinear().domain([0,1.25*d3.max(o,t=>t.population)]);console.log(d3.min(o,t=>t.population)),console.log(d3.max(o,t=>t.population)),c.count={x:i,y:r},l()})}window.addEventListener("resize",()=>{const t=d3.select("#select-city").property("value");d3.csv("csv/"+t+".csv",(t,a)=>{o=a,l()})}),d3.csv("data/teruel/teruel.csv",(t,a)=>{t?console.log(t):((o=a).forEach(t=>{t.year=+t.year,t.name=t.name,t.population=+t.population}),(()=>{const t=n.select(".line-population-teruel-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","line-population-teruel-container-bis")})(),(()=>{const t=d3.scaleTime().domain([d3.min(o,t=>t.year),d3.max(o,t=>t.year)]),a=d3.scaleLinear().domain([0,1.25*d3.max(o,t=>t.population)]);c.count={x:t,y:a}})(),l(),mes="Ababuj",d(mes))}),d3.csv("data/teruel/teruel.csv",(t,a)=>{if(t)console.log(t);else{o=a;const t=d3.nest().key(t=>t.select).entries(o),e=d3.select("#select-city");e.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),e.on("change",function(){d3.select(this).property("value"),d()})}})};vulturno();